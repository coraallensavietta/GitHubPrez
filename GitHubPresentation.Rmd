
---
output:
  html_document:
    highlight: pygments
---

```{r setup, include=FALSE}
# Berry Consultants Stats Call   
# May 28th 2021   
# Cora Allen-Savietta, Ph.D.  
knitr::opts_chunk$set(echo = FALSE)
```


\bigskip

## Getting Started with GitHub
::: columns

:::: column
- Why Version Control?  

  - reproducibility and documentation
  
  - what should I track? .gitignore files

- Why Github?

  - share code with collaborators
  
  - conflict resolution
  
  - code review

- Clone an existing repository
  
- Use GitHub through RStudio

- Additional Useful Tips

::::

:::: column
![](/Users/cora/git_repos/GitHubPrez/octocora.png){ width=80% }
::::
:::

## Why Version Control?

**Git helps you take care of your future self**

As you work, it

- tracks your changes as you work, along with messages about the purposes of each change

- catalogs files over time for easy version control

With built-in documentation and version control, Git makes your projects reproducible, even if you come back months or years later.

- Each snapshot, called a "commit", tracks changes to each file

- To easily look back at a previous version of a project, simply check it a previous commit, then go come back to the newest version.

- built-in reproducibility: with built-in version control and documention, you'll know exactly which version of your code created that design report!

Let's create a new project directory and see how git can help us track our versions.
```{bash, echo = TRUE, eval=FALSE}
mkdir newrepo # create a new folder
cd newrepo
git init # create a git repository
git status
code readme.md # then make changes to the readme in VSCode
git add readme.md # stages file
git commit -m"starting a readme for docs" # create a new commit with a log message
git log # to see our repo's commit history. each commit has a unique ID, called a SHA
git show SHA # use SHA to see only its changes
code readme.md # make new changes to the readme
git diff # see only new differences
git add readme.md # add these changes
git reset # oops! didn't mean to add those
```

What if we have some files that we don't want to track? 

We want to track:

- scripts: any kind of code in R, Python, Julia, Fortran...

- text documentation: 

  - data dictionaries
  
  - data analysis pipeline instructions: step-by-step instructions for reproducing results
  
We should *not* track:

- large data files

- any large files that can be reproduced

- binary files: instead, document where they were obtained or how to recompile

- pdf and figures: instead, document how they can be reproduced

- MS Word/Powerpoint documents: they are not plain text files

To avoid accidentally adding these files, we use a gitignore file!

```{bash, echo = TRUE, eval=FALSE}
code data.csv # add a data file to the repository. we don't want to track this!
code words.docx # create a word document. we don't want to track this either
git status
code .gitignore # create a .gitignore file, add *.csv, *.docx, any other file types you dont want to track
git status
git add .gitignore
git commit -m"adding a gitignore file to ignore csv and docx files"
code words2.docx # create another word file
git status # git automatically does not track it!
code . # untracked files are lighter in VSCode
```

### Why GitHub? Collaborate and Resolve Conflicts Seamlessly!

- Each collaborator has the project on their machine

- To get your changes, they **pull** your changes from the remote.

- To add their changes, they will **push** their additions

- conflict resolution: If you've made changes to the same code, you can handle this with a **merge**, so that you can build on each others work without overwriting or missing updates.

- GitHub's code review functionality makes code review quick and easy. Makes for better, less buggy code!

#### Let's share our new repository with a collaborator!
First, we'll go to GitHub.com, create a new repository, and add our collaborator. Then, we'll connect it to our local repository by following GitHub's instructions.
```{bash, echo = TRUE, eval=FALSE}
git remote add origin https://github.com/coraallensavietta/example-repo.git
git branch -M main # rename main branch
git push -u origin main # push all of my commits to remote
```

#### Resolving Conflicts
Let's say Lindsay goes in and makes changes to our readme.md file. 
In the meantime, I've also made changes to the readme.md file on my local computer. 
```{bash, echo = TRUE, eval=FALSE}
code readme.md # i'll make changes locally
git add
git commit -m"added info about location of the data dictionary"
git push
```
CONFLICT!
Don't worry! This looks scary, but GitHub is great at handling conflicts. That's why we love it!
GitHub will walk us through it.
```{bash, echo = TRUE, eval=FALSE}
git pull # pull Lindsay's changes from the remote
git status 
code readme.md # open the file with the conflict
git add readme.md # add the resolved version of the files
git commit
git push # push the resolved version to the remote server!
```

#### Branches
Sometimes we want to test out a new feature or approach without committing to them. For this, we can create a copy of the main repository and test out our new idea on this **branch**.
```{bash, echo = TRUE, eval=FALSE}
git branch multivar-model # create a new branch to try a multivariate version of the model
git checkout multivar-model # move to this branch
code readme.md # try out this new model!
git add readme.md
git commit -m"trying a multivariate version of the model"
git diff main # compare this branch to the main branch
git push # on no! need to set the remote, just as we did for the main branch
git push --set-upstream origin multivar-model # push changes to the remote repository
```

#### Code Review
GitHub's code review functionality makes code review quick and easy. Makes for better, less buggy code!
On the multivar-model branch, I just added a new version of the data analysis model to our repo. Before it's integrated into our main branch, I'd like Lindsay to look it over for bugs. To do this, I can use [GitHub's pull request process](https://github.com/coraallensavietta/example-repo/pulls).

### Cloning a Repo

Let's illustrate how to get started with the Berry [Shared Simulation Code Library](https://github.com/BerryConsultants/Shared-Trial-Simulation-Library)

Step 1: Navigate to the folder you'd like to house your repo and make sure you're not already in a git repo 
![](/Users/cora/git_repos/GitHubPrez/isgitrepo.png){ width = 30% }
good!

Step 2: Go to GitHub page and copy the http url then go the folder you checked in step one and type
```{bash, echo = TRUE, eval=FALSE}
git clone https://github.com/BerryConsultants/Shared-Trial-Simulation-Library.git
```

You have now cloned the Berry Consultants GitHub Organization Sim Code repo!

If you'd like to contribute your files to the library, clone the library, as shown above, then follow these commands
```{bash, echo = TRUE, eval=FALSE}
git add file-name # adding new edits to staging area
git status
git commit -m"code for simulating a Goldilocks trial with a Win Ratio endpoint" # commit with message
git push # push your additions to the remote repository
```

### Using GitHub through RStudio: 

1. Create a repo or find an existing repo, as described above, then copy the repo's URL.

2. Connect your repository to an RStudio Project

![](/Users/cora/git_repos/GitHubPrez/RS/clone_repo_in_RS.png){ width=30% }


Check your status on the Git Tab within RStudio

![](/Users/cora/git_repos/GitHubPrez/RS/unstaged_changes.png){ width=30% }

Look at the changes you've made with git diff or git history

![](/Users/cora/git_repos/GitHubPrez/RS/gitdiff.png){ width=30% }

![](/Users/cora/git_repos/GitHubPrez/RS/git_history.png){ width=30% }

**Keeping your Repo Up to Date on RStudio: Stage, Commit, Push!**    

Similarly to using GitHub through the terimnal, we'll stage our changes, commit (with a message), and push our changes to the remote.
Step 1: Stage Changes  

![](/Users/cora/git_repos/GitHubPrez/RS/stage_changes.png){ width=30% }

Step 2: Commit Changes

![](/Users/cora/git_repos/GitHubPrez/RS/create_commit.png){ width=30% }

Step 3: Push Changes

![](/Users/cora/git_repos/GitHubPrez/RS/push_changes.png){ width=30% }


### Additional Useful Links
  
  - set up VSCode as your default editor for Git [here](https://stackoverflow.com/questions/30024353/how-to-use-visual-studio-code-as-default-editor-for-git)

- [great documentation for Git](https://git-scm.com/doc)

- Today I've shown you how to use GitHub in the terminal and RStudio, but you can instead use GitHub's desktop app, available [here](https://desktop.github.com/).

- And now that you've caught the GitHub bug, make your own octocat! [MyOctocat.com](https://myoctocat.com/)

![](/Users/cora/git_repos/GitHubPrez/octocora.png){ width=30% }
